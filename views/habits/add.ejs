<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head') %>
<body class=" ">

    <%- include('../partials/nav') %>

    <!-- DIALOG -->
    <dialog id="closeFormDialog">
        <form method="dialog">
            <p>Discard unsaved changes?</p>
            <menu>
                <button id="cancelBtn">Cancel</button>
                <button id="discardBtn">Discard</button>
            </menu>
        </form>
    </dialog>

    <dialog id="deleteConfirmDialog">
        <form method="dialog">
            <p>Are you sure want to delete this Habit?</p>
            <menu>
                <button id="cancelBtn">Cancel</button>
                <button id="deleteBtnDialog">Delete</button>
            </menu>
        </form>

    </dialog>

    <main class="grid min-h-screen pb-20 text-center items-center">

        <button type="button" id="showFormBtn" class="hidden bg-primary text-white rounded px-4 py-2 hover:bg-primary-dark max-w-sm my-3 mx-auto">
            + Add New Habit
        </button>

        <section class="add-habit">
            <span class="text-center text-primary text-3xl font-bold">Add New Habit</span>

            <form action="/add" method="POST" id="habitForm" class="max-w-md mx-auto bg-white shadow-md rounded-lg p-7 space-y-4 text-left">

                    <label for="title">Habit Title</label>
                    <input type="text" id="habitTitle" name="title" placeholder="Enter your habit" autocomplete="off" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">

                    <label for="goal">Habit Goal</label>
                    <input type="text" id="habitGoal" name="goal" placeholder="Enter your goal" autocomplete="off" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">

                    <label for="schedule">Habit Schedule</label>
                    <select name="schedule" id="habitSchedule" required  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="" disabled selected>Select schedule</option>
                        <option value="Daily">Daily</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Custom">Custom</option>
                    </select>

                <fieldset id="weeklyDay" name="weeklySchedule"  class="hidden mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ">

                    <legend>Select Day</legend>
                    <label for="sunday"><input type="radio" value="Sunday" name="weeklyDay"> Sun</label>
                    <label for="monday"><input type="radio" value="Monday" name="weeklyDay"> Mon</label>
                    <label for="tuesday"><input type="radio" value="Tuesday" name="weeklyDay"> Tues</label>
                    <label for="wednesday"><input type="radio" value="Wednesday" name="weeklyDay"> Wed</label>
                    <label for="thursday"><input type="radio" value="Thursday" name="weeklyDay"> Thur</label>
                    <label for="friday"><input type="radio" value="Friday" name="weeklyDay"> Fri</label>
                    <label for="saturday"><input type="radio" value="Saturday" name="weeklyDay"> Sat</label>

                </fieldset>

                <fieldset id="customDays" name="custom-day"  class="hidden mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <legend>Select Days</legend>

                    <input type="checkbox" name="customDays" value="Sunday" id="sunday">
                    <label for="sunday">Sun</label>

                    <input type="checkbox" name="customDays" value="Monday" id="monday">
                    <label for="monday">Mon</label>

                    <input type="checkbox" name="customDays" value="Tuesday" id="tuesday">
                    <label for="tuesday">Tues</label>

                    <input type="checkbox" name="customDays" value="Wednesday" id="wednesday">
                    <label for="wednesday">Wed</label>

                    <input type="checkbox" name="customDays" value="Thursday" id="thursday">
                    <label for="thursday">Thur</label>

                    <input type="checkbox" name="customDays" value="Friday" id="friday">
                    <label for="friday">Fri</label>

                    <input type="checkbox" name="customDays" value="Saturday" id="saturday">
                    <label for="saturday">Sat</label>

                </fieldset>

                <label for="time">Time</label>
                <input type="time" id="time" name="time" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">

                <button type="submit" id="addHabitBtn" class="bg-primary text-white px-4 py-2 rounded mr-4 hover:bg-primary-dark">Add Habit</button>
            </form>

        </section>

        <section class="habit-display text-center ">
            <div id="habitsContainer" class="space-y-6 p-6 mx-auto max-w-lg">
                <span class="text-center text-primary text-3xl font-bold">Your Habit List</span>

                <% if (habits.length > 0) { %>
                <div id="habitsList" class="space-y-6 p-5">
                    <% habits.forEach(habit => { %>
                    <div class="rounded-lg shadow-md bg-primary text-left p-5 my-4 text-white flex justify-between">
                        <div>
                            <h3 class="text-xl font-bold">
                                <%= habit.title %> - <%= habit.goal %>
                            </h3>
                            <p class="text-sm opacity-90">
                                <%= habit.schedule %> at <%= habit.time %>
                            </p>
                        </div>
                        <a id="deleteButton" data-doc="<%= habit._id %>" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 cursor-pointer">Delete</a>
                    </div>
                    <% }) %>
                </div>
                <% } else { %>
                <p class="text-gray-500 text-center">No habits yet</p>
                <% } %>
            </div>
        </section>
    </main>

    <footer>
        <p class="text-center">Â© 2025 HabitIn. Created by Ness.</p>
    </footer>
    
    <script src="/js/main.js"></script>
</body>
</html>